<app-frame-nav cdkDropListGroup class="w-full bg-[url('/assets/cool-background.png')] bg-cover">
  <div id="parent" #parent class="appear grid grid-flow-col overflow-auto p-4" (wheel)="onWheel($event)" (mousedown) ="startDragging($event, false)" (pointerup) ="stopDragging($event, false)" (mouseleave) ="stopDragging($event, false)" (mousemove)="moveEvent($event)">
    <div
      class="flex h-fit min-h-64 w-64 min-w-64 select-none flex-col overflow-hidden rounded-xl bg-slate-900 bg-opacity-95 p-2 text-gray-300  animate-in duration-600 zoom-in-[0.8] "
    >
      <!-- <div class="mb-[-8px] mt-[-9px] h-1 w-full bg-yellow-300">

      </div> -->
      <div class="flex items-center p-2">
        <span class="border-b-2  border-blue-600">Técnicos</span>
        <span class="material-symbols-outlined ml-auto"> more_horiz </span>
        </div>

        <div
          class="min-h-48 rounded-b-md p-2 pb-6"
        >
        <div>

      </div >

      <!-- lista de técnicos -->
      <div >
          @for (item of tecnicosdata ; track item.id) {
            <div
              cdkDropList
              [cdkDropListData]="item.expand?.chamados"
              (cdkDropListDropped)="dropTecnico($event, item)"
              (cdkDropListEntered)="tecnicoEntered($event)"

              class="mt-2 flex h-8 max-h-8 w-full cursor-pointer items-center rounded-full bg-slate-700 px-1 py-1 hover:bg-slate-600 transition-all"
            >
              <img
                class="h-6 w-6 rounded-full"
                src="https://as2.ftcdn.net/v2/jpg/05/49/98/39/1000_F_549983970_bRCkYfk0P6PP5fKbMhZMIb07mCJ6esXL.jpg"
              />
              @if (item.chamados.length == 0) {
                <span class="ml-1 mr-1 flex h-2 w-2 rounded-full bg-green-500"></span>
              }
              @if (item.chamados.length > 0 && item.chamados.length < 3) {
                <span class="ml-1 mr-1 flex h-2 w-2 rounded-full bg-yellow-400"></span>
              }
              @if (item.chamados.length > 2) {
                <span class="ml-1 mr-1 flex h-2 w-2 rounded-full bg-red-500"></span>
              }

              <span class="truncate text-sm">{{ item.username}}</span>

            </div>
          }
      </div>
    </div>

      <div class="flex h-8 items-center p-1"></div>
    </div>



    <div
      class="ml-4 flex h-fit min-h-64 w-64 min-w-64 select-none flex-col rounded-xl bg-slate-900 bg-opacity-95 p-2 text-gray-300  animate-in duration-600 zoom-in-[0.8]"
    >
      <!-- <div class="mb-[-8px] mt-[-9px] h-1 w-full bg-yellow-300">

        </div> -->
      <div class="flex items-center p-2">
        <span class="border-b-2 border-yellow-300">Chamados</span>
        <span class="material-symbols-outlined ml-auto"> more_horiz </span>
      </div>

      <div
          class="min-h-48 rounded-b-md p-2 pb-6"
          cdkDropList
          [cdkDropListData]="chamadosdata"
          (cdkDropListDropped)="drop($event)"
          (cdkDropListEntered)="updateStyle()"
        >

        <!-- Lista de chamados -->
        @for (item of chamadosdata; track item) {
          <div
            (click)="openServiceEsperando(item)"
            class="mt-2 flex w-full cursor-grab items-center rounded-full bg-slate-700 px-2 py-1 hover:bg-slate-600 border-b-2"
            [class]="{ 
            'border-green-500': item.priority == -1,
            'border-blue-500': item.priority == 0,
            'border-yellow-500': item.priority == 1,
            'border-red-500': item.priority == 2}"
          
            cdkDrag
          >

            <!-- <span class="me-3 flex h-3 w-3 rounded-full bg-green-500"></span> -->
            <div class="flex w-full items-center">
              <span class="material-symbols-outlined text-base"> call </span>
              <span class="ml-2 truncate text-sm w-full">{{ item.title }}</span>
              <div class="flex  justify-end item-center">
                @if (item.public == false) {
                  <span class="material-symbols-outlined" matTooltip="Só você e gerentes podem ver esse chamado">
                    visibility_off
                  </span>
                }
              </div>
            </div>
          </div>
        }
      </div>

      <div (click)="addService()" class="flex h-8 items-center p-1 hover:cursor-pointer transition-all hover:text-slate-200">
        <span class="material-symbols-outlined"> add </span>
        <span>Add Serviço</span>
      </div>
    </div>

    <!-- <div class="ml-[7px] mr-[7px] h-full border border-dashed border-yellow-300"></div> -->

    <!-- Kanba pra cada técnico -->
    @for (tecnico of tecnicosdata; track tecnico) {
      <div
      class="ml-4 flex h-fit min-h-64 w-64 min-w-64 select-none flex-col rounded-xl bg-slate-900 bg-opacity-95 p-2 text-gray-300 animate-in duration-600 zoom-in-[0.8]"
    >
      <div class="flex items-center p-2">
        <span class="border-b-2 border-purple-600">{{tecnico.username}}</span>
        <span class="material-symbols-outlined ml-auto"> more_horiz </span>
      </div>

      <div
          class="min-h-48 rounded-b-md p-2 pb-6"
          cdkDropList
          [cdkDropListData]="tecnico.expand?.chamados"
          (cdkDropListDropped)="dropTecnico($event, tecnico)"
        >
          @for (item of tecnico.chamados; track item) {
          <div
            (click)="openService(item)"
            class="mt-2 flex w-full  items-center rounded-full   border-b-2 border-blue-500 px-2 py-1 h-8 transition-all duration-75 bg-slate-700 "
            [ngClass]="{
                'border-green-500': item.priority === -1,
                'border-blue-500': item.priority === 0,
                'border-yellow-500': item.priority === 1,
                'border-red-500': item.priority === 2,
                'hover:bg-slate-600 cursor-pointer hover:border-b-0 hover:translate-y-[2px]': item.description !== 'null',
                'opacity-50': item.description === 'null'
              }"
            >

            <div class="flex w-[160px] items-center">
              <span class="material-symbols-outlined text-base"> call </span>
              @if (item.title.length > 16) {
                <div class="ml-2 truncate text-sm" matTooltip="{{item.title}}">{{ item.title }}</div>
              } @else {
                <div class="ml-2 truncate text-sm">{{ item.title }}</div>
              }
            </div>

            <div class="flex justify-end item-center w-full">
                @if (item.expand.users.length > 1) {
                  <span class="material-symbols-outlined"  [matTooltip]="getUserNames(item.expand.users)">
                    group
                  </span>
                }
                @if (item.status == "em_pausa"){
                  <span class="material-symbols-outlined text-yellow-400 hover:animate-pulse" matTooltip="Chamado pausado">
                  pause
                  </span>
                }
                @if (item.status == "aguardando"){
                  <span class="material-symbols-outlined text-blue-400 hover:animate-pulse" matTooltip="Chamado aguardando inicio">
                  hourglass_top
                  </span>
                }
                @if (item.status == "em_andamento"){
                  <span class="material-symbols-outlined text-green-400 hover:animate-pulse" matTooltip="Chamado em andamento">
                  keyboard_double_arrow_up
                  </span>
                }
            </div>
           
          </div>
          }
      </div>

      <div class="flex h-8 items-center p-1"></div>
      
    </div>
    }
  </div>
</app-frame-nav>
